<?php

namespace App\Domain\Pentests\Actions;

use App\Data\Pentests\PentestData;
use App\Models\Pentest;
use Illuminate\Support\Collection;

class GetAllPentestsAction
{
    /**
     * @return Collection<int, PentestData>
     */
    public function execute(): Collection
    {
        return Pentest::orderBy('created_at', 'desc')
            ->get()
            ->map(fn (Pentest $pentest) => PentestData::from([
                'id' => $pentest->id,
                'name' => $pentest->name,
                'target_url' => $pentest->target_url,
                'status' => $pentest->status,
                'current_step' => $pentest->current_step,
                'step_progress' => $pentest->step_progress,
                'started_at' => $pentest->started_at?->toISOString(),
                'completed_at' => $pentest->completed_at?->toISOString(),
                'created_at' => $pentest->created_at->toISOString(),
                'updated_at' => $pentest->updated_at->toISOString(),
            ]));
    }
}

