<?php

namespace App\Domain\Pentests\Actions;

use App\Data\Pentests\CreatePentestData;
use App\Data\Pentests\PentestData;
use App\Models\Pentest;

class CreatePentestAction
{
    public function execute(CreatePentestData $data): PentestData
    {
        $pentest = Pentest::create([
            'name' => $data->name,
            'target_url' => $data->config->targetUrl,
            'status' => 'pending',
            'config' => $data->config->toArray(),
        ]);

        return PentestData::from([
            'id' => $pentest->id,
            'name' => $pentest->name,
            'target_url' => $pentest->target_url,
            'status' => $pentest->status,
            'current_step' => $pentest->current_step,
            'step_progress' => $pentest->step_progress,
            'started_at' => $pentest->started_at?->toISOString(),
            'completed_at' => $pentest->completed_at?->toISOString(),
            'created_at' => $pentest->created_at->toISOString(),
            'updated_at' => $pentest->updated_at->toISOString(),
        ]);
    }
}

