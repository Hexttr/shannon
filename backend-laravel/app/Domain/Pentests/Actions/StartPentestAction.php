<?php

namespace App\Domain\Pentests\Actions;

use App\Domain\Pentests\Jobs\RunPentestJob;
use App\Models\Pentest;

class StartPentestAction
{
    public function execute(string $id): void
    {
        $pentest = Pentest::findOrFail($id);

        if ($pentest->status !== 'pending') {
            throw new \RuntimeException('Пентест уже запущен или завершен');
        }

        $pentest->update([
            'status' => 'running',
            'started_at' => now(),
        ]);

        // Запускаем пентест в фоновом режиме через очередь
        RunPentestJob::dispatch($id);
    }
}

