<?php

namespace App\Domain\Logs\Actions;

use App\Data\Logs\LogData;
use App\Models\Pentest;
use Illuminate\Support\Collection;

class GetLogsByPentestAction
{
    /**
     * @return Collection<int, LogData>
     */
    public function execute(string $pentestId): Collection
    {
        $pentest = Pentest::findOrFail($pentestId);

        return $pentest->logs()
            ->orderBy('created_at', 'asc')
            ->get()
            ->map(fn ($log) => LogData::from([
                'id' => $log->id,
                'pentest_id' => $log->pentest_id,
                'level' => $log->level,
                'message' => $log->message,
                'timestamp' => $log->created_at->toISOString(),
            ]));
    }
}

