import api from './api';
import { Pentest, CreatePentestRequest, PentestStatusResponse, Vulnerability, Log } from '../types';

export const pentestApi = {
  getAll: async (): Promise<{ data: Pentest[] }> => {
    return api.get<Pentest[]>('/api/pentests');
  },

  getById: async (id: number): Promise<{ data: Pentest }> => {
    return api.get<Pentest>(`/api/pentests/${id}`);
  },

  create: async (data: CreatePentestRequest): Promise<{ data: Pentest }> => {
    return api.post<Pentest>('/api/pentests', data);
  },

  start: async (id: number): Promise<void> => {
    return api.post(`/api/pentests/${id}/start`);
  },

  stop: async (id: number): Promise<void> => {
    return api.post(`/api/pentests/${id}/stop`);
  },

  getStatus: async (id: number): Promise<{ data: PentestStatusResponse }> => {
    return api.get<PentestStatusResponse>(`/api/pentests/${id}/status`);
  },

  getVulnerabilities: async (id: number): Promise<{ data: Vulnerability[] }> => {
    return api.get<Vulnerability[]>(`/api/pentests/${id}/vulnerabilities`);
  },

  getLogs: async (id: number): Promise<{ data: Log[] }> => {
    return api.get<Log[]>(`/api/pentests/${id}/logs`);
  },

  delete: async (id: number): Promise<void> => {
    return api.delete(`/api/pentests/${id}`);
  },

  generateReport: async (id: number): Promise<{ data: { message: string; markdown_path: string } }> => {
    return api.post(`/api/pentests/${id}/reports`);
  },

  checkReportExists: async (id: number): Promise<{ data: { exists: boolean } }> => {
    return api.get<{ exists: boolean }>(`/api/pentests/${id}/reports/check`);
  },

  generatePdfReport: async (id: number): Promise<Blob> => {
    const response = await api.get(`/api/pentests/${id}/reports/pdf`, {
      responseType: 'blob',
    });
    return response.data;
  },
};

